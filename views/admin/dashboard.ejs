    <%- include("../layouts/admin/header.ejs")  %>
    
    <%- include("../layouts/admin/navbar.ejs")  %>
    <main class="main-wrap">
        <!--  -->
        <%- include("../layouts/admin/topnav.ejs")  %>


        <style>
            .dashboard-section {
              margin: 2rem 0;
              padding: 0 1rem;
            }
          
            .section-heading {
              color: #333;
              font-size: 2rem;
              font-weight: bold;
              margin-bottom: 1.5rem;
              padding-bottom: 0.5rem;
              border-bottom: 2px solid #3b82f6;
            }
          
            .data-table {
              width: 100%;
              border-collapse: collapse;
              background-color: #fff;
              box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
              margin-bottom: 2rem;
            }
          
            .data-table th {
              background-color: #f8fafc;
              color: #1f2937;
              font-weight: 600;
              padding: 1rem;
              text-align: left;
              border-bottom: 2px solid #e2e8f0;
            }
          
            .data-table td {
              padding: 1rem;
              border-bottom: 1px solid #e2e8f0;
              color: #4b5563;
            }
          
            .data-table tr:hover {
              background-color: #f8fafc;
            }
          
            .data-table tr:last-child td {
              border-bottom: none;
              
            }
            .hidden {
              display: none;
            }
          
            .visible {
              display: block;
            }

            /* Remove white space on the top left */
/* General Styling for the Card */
.card {
  margin: 0 auto;
  padding: 0;
  border: 1px solid #e2e8f0;
  border-radius: 10px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  background-color: #fff;
}

/* Card Header */
.card-header {
  background-color: #3b82f6; /* Light blue header */
  color: #fff;
  border-radius: 10px 10px 0 0;
  padding: 1rem 1.5rem;
  font-size: 1.25rem;
  font-weight: 600;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

/* Dropdown Select Styling */
.custom_select select {
  width: 100%;
  padding: 0.5rem;
  border: 1px solid #d1d5db;
  border-radius: 5px;
  font-size: 0.9rem;
  color: #374151;
  background-color: #f9fafb;
}

/* Filter Form Buttons */
button.btn-primary {
  background-color: #2563eb;
  color: #fff;
  border: none;
  border-radius: 5px;
  padding: 0.5rem 1rem;
  font-size: 0.9rem;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

button.btn-primary:hover {
  background-color: #1e40af;
}

/* Download Buttons */
.btn-primary,
.btn-success {
  margin: 0.5rem;
  font-size: 0.9rem;
  padding: 0.6rem 1.2rem;
  border-radius: 5px;
  color: #fff;
  transition: all 0.3s ease-in-out;
}

.btn-primary:hover {
  background-color: #0056b3;
}

.btn-success:hover {
  background-color: #218838;
}

/* Card Body */
.card-body {
  padding: 1.5rem;
}

/* Grand Total Section */
.card-body h5 {
  font-size: 1.1rem;
  font-weight: bold;
  color: #374151;
}

/* Table Styling */
.table {
  width: 100%;
  margin-top: 1rem;
  border-collapse: collapse;
}

.table th,
.table td {
  padding: 1rem;
  text-align: center;
  border: 1px solid #e2e8f0;
  color: #374151;
  font-size: 0.9rem;
}

.table th {
  background-color: #f3f4f6;
  font-weight: 600;
}

.table tbody tr:hover {
  background-color: #f9fafb;
}

.table-light {
  background-color: #e5e7eb;
}

.badge-pill {
  padding: 0.4rem 0.8rem;
  font-size: 0.85rem;
  border-radius: 30px;
  color: #fff;
  display: inline-block;
}

.badge-soft-success {
  background-color: #10b981;
}

.badge-soft-danger {
  background-color: #ef4444;
}

/* Custom Date Range */
#custom-date-range input {
  margin: 0.5rem 0;
  padding: 0.5rem;
  border: 1px solid #d1d5db;
  border-radius: 5px;
  font-size: 0.9rem;
  width: 100%;
}

/* Mobile Responsiveness */
@media (max-width: 768px) {
  .card-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 0.5rem;
  }

  .custom_select,
  .btn {
    width: 100%;
    margin-bottom: 0.5rem;
  }

  .card-body {
    padding: 1rem;
  }

  .table th,
  .table td {
    font-size: 0.8rem;
    padding: 0.8rem;
  }
}

/* General styling for the container */
.filter-container {
  margin-bottom: 1rem;
}

/* Flexbox container styling */
.d-flex {
  display: flex;
}

.justify-content-end {
  justify-content: flex-end;
}

.align-items-center {
  align-items: center;
}

.gap-2 {
  gap: 0.5rem;
}

/* Select dropdown styling */
.form-select {
  width: auto;
  min-width: 150px;
  padding: 0.375rem 0.75rem;
  font-size: 1rem;
  border: 1px solid #ced4da;
  border-radius: 0.25rem;
  background-color: #f8f9fa;
}

/* Date input styling */
.form-control {
  width: auto;
  padding: 0.375rem 0.75rem;
  font-size: 1rem;
  border: 1px solid #ced4da;
  border-radius: 0.25rem;
}

/* Button styling */
.btn {
  padding: 0.375rem 0.75rem;
  font-size: 1rem;
  border-radius: 0.25rem;
  box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1);
}

.btn-primary {
  background-color: #007bff;
  border-color: #007bff;
  color: #fff;
}

.btn-primary:hover {
  background-color: #0056b3;
  border-color: #004085;
}



          </style>
         
          
          
          
       
        <section class="content-main">
            <div class="content-header">
                <div>
                    <h2 class="content-title card-title">Dashboard </h2>
                    <p>Whole data about your business here</p>
                </div>
               
            </div>
              <!-- total sales and products toltal couts showing div -->
            <div class="row">
                <div class="col-lg-3">
                    <div class="card card-body mb-4">
                        <article class="icontext">
                            <span class="icon icon-sm rounded-circle bg-primary-light"><i class="text-primary material-icons md-monetization_on"></i></span>
                            <div class="text">
                                <h6 class="mb-1 card-title">Total sales</h6>
                                <span>â‚¹<%= grandTotal %></span>
                                <span class="text-sm">
                                    Shipping fees are not included
                                </span>
                            </div>
                        </article>
                    </div>
                </div>
                <div class="col-lg-3">
                    <div class="card card-body mb-4">
                        <article class="icontext">
                            <span class="icon icon-sm rounded-circle bg-success-light"><i class="text-success material-icons md-local_shipping"></i></span>
                            <div class="text">
                                <h6 class="mb-1 card-title">Orders</h6> <span><%= totalOrders %></span>
                                <span class="text-sm">
                                    Excluding orders in transit
                                </span>
                            </div>
                        </article>
                    </div>
                </div>
                <div class="col-lg-3">
                    <div class="card card-body mb-4">
                        <article class="icontext">
                            <span class="icon icon-sm rounded-circle bg-warning-light"><i class="text-warning material-icons md-qr_code"></i></span>
                            <div class="text">
                                <h6 class="mb-1 card-title">Products</h6> <span><%= productCount %></span>
                                <span class="text-sm">
                                    In 4 Categories
                                </span>
                            </div>
                        </article>
                    </div>
                </div>
                <!-- <div class="col-lg-3">
                    <div class="card card-body mb-4">
                        <article class="icontext">
                            <span class="icon icon-sm rounded-circle bg-info-light"><i class="text-info material-icons md-shopping_basket"></i></span>
                            <div class="text">
                                <h6 class="mb-1 card-title">Monthly Earning</h6> <span></span>
                                <span class="text-sm">
                                    Based in your local time.
                                </span>
                            </div>
                        </article>
                    </div> -->
                </div>

              <!-- Ending total sales and products toltal couts showing div -->

               
            </div>
            <div class="row">
              <div class="col-xl-8 col-lg-12">
                <div class="card mb-4">
                  <article class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                      <h5 class="card-title">Sales Report</h5>
                      <div class="dropdown">
                        <button class="btn btn-primary dropdown-toggle" type="button" id="dateFilterDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                          Filter: <span id="selectedFilter">Daily</span>
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="dateFilterDropdown">
                          <li><a class="dropdown-item filter-option" href="#" data-filter="daily">Daily</a></li>
                          <li><a class="dropdown-item filter-option" href="#" data-filter="monthly">Monthly</a></li>
                          <li><a class="dropdown-item filter-option" href="#" data-filter="yearly">Yearly</a></li>
                          <li><a class="dropdown-item filter-option" href="#" data-filter="custom">Custom Date</a></li>
                        </ul>
                      </div>
                    </div>
                    <div id="customDateFilter" class="mt-3" style="display: none;">
                      <input type="date" id="startDate" class="form-control mb-2" placeholder="Start Date">
                      <input type="date" id="endDate" class="form-control" placeholder="End Date">
                      <button id="applyCustomDate" class="btn btn-primary mt-2">Apply</button>
                    </div>
                    <canvas id="salesChart" height="120px"></canvas>
                  </article>
                </div>
              </div>
            </div>
            
            <div class="dashboard-section">
                <h2 class="section-heading">Top-Selling Products</h2>
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>Product Name</th>
                      <th>Sales Count</th>
                      <th>Category</th>
                      <th>Brand</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% topProducts.forEach(product => { %>
                      <tr>
                        <td><%= product.name %></td>
                        <td><%= product.count %></td>
                        <td><%= product.categoryName %></td>
                        <td><%= product.brandName %></td>
                      </tr>
                    <% }); %>
                  </tbody>
                </table>
              </div>
              
              <div class="dashboard-section">
                <h2 class="section-heading">Top-Selling Categories</h2>
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>Category Name</th>
                      <th>Sales Count</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% categorySales.forEach(category => { %>
                      <tr>
                        <td><%= category.categoryName %></td>
                        <td><%= category.count %></td>
                      </tr>
                    <% }); %>
                  </tbody>
                </table>
              </div>
              
              <div class="dashboard-section">
                <h2 class="section-heading">Top-Selling Brands</h2>
                <table class="data-table">
                  <thead>
                    <tr>
                      <th>Brand Name</th>
                      <th>Sales Count</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% brandSales.forEach(brand => { %>
                      <tr>
                        <td><%= brand.brandName %></td>
                        <td><%= brand.count %></td>
                      </tr>
                    <% }); %>
                  </tbody>
                </table>
              </div>



              <div class="card mb-4" style="margin: 0; padding: 0;">
                <header class="card-header">
                  <h2 class="card-title">Sales Report</h2>
                  <div class="row align-items-center justify-content-end">
                    <div class="col-md-2 col-6">
                      <div class="custom_select">
                        <div class="filter-container d-flex justify-content-end align-items-center">
                        <form id="filterForm" action="/admin/dashboard" method="GET">
                          <select name="filter" id="filter-select">
                            <option value="All" <%= filter === "All" ? "selected" : "" %>>All</option>
                            <option value="Today" <%= filter === "Today" ? "selected" : "" %>>Today</option>
                            <option value="This Week" <%= filter === "This Week" ? "selected" : "" %>>This Week</option>
                            <option value="Last Month" <%= filter === "Last Month" ? "selected" : "" %>>Last Month</option>
                            <option value="Yearly" <%= filter === "Yearly" ? "selected" : "" %>>Yearly</option>
                            <option value="Custom" <%= filter === "Custom" ? "selected" : "" %>>Custom</option>
                          </select>
                          <div id="custom-date-range" class="<%= filter === 'Custom' ? 'visible' : 'hidden' %>">
                            <input type="date" name="startDate" value="<%= startDate || '' %>" />
                            <input type="date" name="endDate" value="<%= endDate || '' %>" />
                          </div>
                          <button type="submit" class="btn btn-sm btn-primary">Apply</button>
                        </form>
                      </div>
                      </div>
                    </div>
                  </div>
                  
                </header>

                <div class="mb-3 text-end">
                  <a href="/admin/dashboard/pdf?filter=<%= filter %>&startDate=<%= startDate %>&endDate=<%= endDate %>" class="btn btn-primary">Download PDF</a>
                  <a href="/admin/dashboard/excel?filter=<%= filter %>&startDate=<%= startDate %>&endDate=<%= endDate %>" class="btn btn-success">Download Excel</a>
                </div>
                
                

                <div class="card-body">
                  <div class="mb-3 text-end">
                    <h5>Grand Total: â‚¹<%= grandTotal || 0 %></h5>
                  </div>
                  <div class="table-responsive">
                    <table class="table align-middle table-nowrap mb-0">
                      <thead class="table-light">
                        <tr>
                          <th scope="col" class="text-center">
                            <div class="form-check align-middle">
                              <input class="form-check-input" type="checkbox" id="selectAll">
                              <label class="form-check-label" for="selectAll"></label>
                            </div>
                          </th>
                          <th class="align-middle" scope="col">Order ID</th>
                          <th class="align-middle" scope="col">Product Name</th>
                          <th class="align-middle" scope="col">Date</th>
                          <th class="align-middle" scope="col">Total</th>
                          <th class="align-middle" scope="col">Payment Status</th>
                          <th class="align-middle" scope="col">Payment Method</th>
                        </tr>
                      </thead>
                      <tbody>
                        <% if (orders && orders.length > 0) { %>
                          <% orders.forEach(order => { %>
                            <tr>
                              <td class="text-center">
                                <div class="form-check align-middle">
                                  <input class="form-check-input" type="checkbox" id="orderCheck<%= order._id %>">
                                  <label class="form-check-label" for="orderCheck<%= order._id %>"></label>
                                </div>
                              </td>
                              <td><a href="#" class="fw-bold"><%= order.orderId %></a></td>
                              <td>
                                <% order.items.forEach(item => { %>
                                  <div><%= item.name %> (<%= item.quantity %> x <%= item.size %>)</div>
                                <% }) %>
                              </td>
                              <td><%= new Date(order.createdAt).toLocaleDateString() %></td>
                              <td>â‚¹<%= order.total_price %></td>
                              <td>
                                <span class="badge badge-pill <%= order.payment_status === 'success' ? 'badge-soft-success' : 'badge-soft-danger' %>">
                                  <%= order.payment_status %>
                                </span>
                              </td>
                              <td>
                                <i class="material-icons md-payment font-xxl text-muted mr-5"></i>
                                <%= order.payment_method %>
                              </td>
                            </tr>
                          <% }) %>
                        <% } else { %>
                          <tr>
                            <td colspan="7" class="text-center">No orders found.</td>
                          </tr>
                        <% } %>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
              
              
            <div class="pagination-area mt-30 mb-50">
                <nav aria-label="Page navigation example">
                    <ul class="pagination justify-content-start">
                        <li class="page-item active"><a class="page-link" href="#">01</a></li>
                        <li class="page-item"><a class="page-link" href="#">02</a></li>
                        <li class="page-item"><a class="page-link" href="#">03</a></li>
                        <li class="page-item"><a class="page-link dot" href="#">...</a></li>
                        <li class="page-item"><a class="page-link" href="#">16</a></li>
                        <li class="page-item"><a class="page-link" href="#"><i class="material-icons md-chevron_right"></i></a></li>
                    </ul>
                </nav>
            </div>
        </section> <!-- content-main end// -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
       
        <%- include("../layouts/admin/footer.ejs")  %>


<script>
  document.addEventListener("DOMContentLoaded", () => {
    const ctx = document.getElementById("salesChart").getContext("2d");
    let salesChart;
  
    function renderChart(data, labels) {
      const chartType = data.length > 1 ? 'line' : 'scatter';
      if (salesChart) salesChart.destroy();
      salesChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'Sales',
            data: data,
            backgroundColor: 'rgba(75, 192, 192, 0.2)',
            borderColor: 'rgba(75, 192, 192, 1)',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: { beginAtZero: true }
          }
        }
      });
    }
  
    async function fetchData(filterType, startDate, endDate) {
      try {
        const url = new URL('/admin/dashboard/saleschart', window.location.origin);
        url.searchParams.append('filter', filterType);
        if (startDate) url.searchParams.append('start', startDate);
        if (endDate) url.searchParams.append('end', endDate);
  
        const response = await fetch(url);
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        const { data, labels } = await response.json();
        console.log("data and  is ",data, )
        console.log("lebals is ",labels)
        renderChart(data, labels);
        
      } catch (error) {
        console.error("Error fetching sales data:", error);
        alert("Failed to fetch sales data. Please try again.");
      }
    }
  
    document.querySelectorAll(".filter-option").forEach(option => {
      option.addEventListener("click", (e) => {
        e.preventDefault();
        const filterType = e.target.dataset.filter;
        document.getElementById("selectedFilter").innerText = filterType.charAt(0).toUpperCase() + filterType.slice(1);
        
        const customDateFilter = document.getElementById("customDateFilter");
        if (filterType === "custom") {
          customDateFilter.style.display = "block";
        } else {
          customDateFilter.style.display = "none";
          fetchData(filterType);
        }
      });
    });
  
    document.getElementById("applyCustomDate").addEventListener("click", () => {
      const startDate = document.getElementById("startDate").value;
      const endDate = document.getElementById("endDate").value;
      if (startDate && endDate) {
        fetchData("custom", startDate, endDate);
      } else {
        alert("Please select both start and end dates.");
      }
    });
  
    // Initial chart load
    fetchData("daily");
  });
  </script>



<script>
  document.getElementById('filter-select').addEventListener('change', function () {
    const customDateRange = document.getElementById('custom-date-range');
    if (this.value === 'Custom') {
      customDateRange.style.display = 'block';
    } else {
      customDateRange.style.display = 'none';
    }
  });
</script>
