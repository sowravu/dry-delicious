<%- include("../layouts/user/header.ejs") %>

    <style>
        /* Styling for payment options */
        .payment-accordion .card-header label {
            display: flex;
            align-items: center;
            font-weight: bold;
            font-size: 1.1em;
            cursor: pointer;
        }

        .payment-accordion input[type="radio"] {
            margin-right: 10px;
            transform: scale(1.2);
        }


    </style>
            <style>
                .payment-accordion .card-header label {
                    display: flex;
                    align-items: center;
                    font-weight: bold;
                    font-size: 1.1em;
                    cursor: pointer;
                }

                .payment-accordion input[type="radio"] {
                    margin-right: 10px;
                    transform: scale(1.2);
                }
            </style>


<style>
 .modal {
    display: none;
    position: fixed;
    z-index: 1050;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%; /* Changed from 50% to 100% for better responsiveness */
    overflow: auto; /* Added for scrollable content */
    background-color: rgba(0, 0, 0, 0.5);
}

.modal-dialog {
    margin: 5% auto; /* Adjusted top margin for better centering */
    max-width: 90%; /* Set maximum width for smaller screens */
    width: 500px; /* Set a fixed width for larger screens */
}

.modal-content {
    background-color: #fff;
    padding: 1rem;
    border-radius: 5px;
    height: auto; /* Let content determine height */
    max-height: 80vh; /* Prevent modal from overflowing vertically */
    overflow-y: auto; /* Add vertical scroll if content exceeds max height */
}


</style>

    <div class="pageWrapper">
        <!--Search Form Drawer-->
        <div class="search">
            <div class="search__form">
                    <button class="go-btn search__button" type="submit"><i class="icon anm anm-search-l"></i></button>
                    <input class="search__input" type="search" name="q" value="" placeholder="Search entire store..."
                        aria-label="Search" autocomplete="off">
                <button type="button" class="search-trigger close-btn"><i class="icon anm anm-times-l"></i></button>
            </div>
            
        </div>
        <%- include("../layouts/user/topnav.ejs") %>

            <!--End Search Form Drawer-->
            <!--Top Header-->

            <!--End Header-->
            <!--Mobile Menu-->
            <div class="mobile-nav-wrapper" role="navigation">
                <div class="closemobileMenu"><i class="icon anm anm-times-l pull-right"></i> Close Menu</div>
                <ul id="MobileNav" class="mobile-nav">
                    <li class="lvl1 parent megamenu"><a href="index.html">Home <i class="anm anm-plus-l"></i></a>
                        <ul>
                            <li><a href="#" class="site-nav">Home Group 1<i class="anm anm-plus-l"></i></a>
                                <ul>
                                    <li><a href="index.html" class="site-nav">Home 1 - Classic</a></li>
                                    <li><a href="home2-default.html" class="site-nav">Home 2 - Default</a></li>
                                    <li><a href="home15-funiture.html" class="site-nav">Home 15 - Furniture </a></li>
                                    <li><a href="home3-boxed.html" class="site-nav">Home 3 - Boxed</a></li>
                                    <li><a href="home4-fullwidth.html" class="site-nav">Home 4 - Fullwidth</a></li>
                                    <li><a href="home5-cosmetic.html" class="site-nav">Home 5 - Cosmetic</a></li>
                                    <li><a href="home6-modern.html" class="site-nav">Home 6 - Modern</a></li>
                                    <li><a href="home7-shoes.html" class="site-nav last">Home 7 - Shoes</a></li>
                                </ul>
                            </li>
                            <li><a href="#" class="site-nav">Home Group 2<i class="anm anm-plus-l"></i></a>
                                <ul>
                                    <li><a href="home8-jewellery.html" class="site-nav">Home 8 - Jewellery</a></li>
                                    <li><a href="home9-parallax.html" class="site-nav">Home 9 - Parallax</a></li>
                                    <li><a href="home10-minimal.html" class="site-nav">Home 10 - Minimal</a></li>
                                    <li><a href="home11-grid.html" class="site-nav">Home 11 - Grid</a></li>
                                    <li><a href="home12-category.html" class="site-nav">Home 12 - Category</a></li>
                                    <li><a href="home13-auto-parts.html" class="site-nav">Home 13 - Auto Parts</a></li>
                                    <li><a href="home14-bags.html" class="site-nav last">Home 14 - Bags</a></li>
                                </ul>
                            </li>
                            <li><a href="#" class="site-nav">New Sections<i class="anm anm-plus-l"></i></a>
                                <ul>
                                    <li><a href="home11-grid.html" class="site-nav">Image Gallery</a></li>
                                    <li><a href="home5-cosmetic.html" class="site-nav">Featured Product</a></li>
                                    <li><a href="home7-shoes.html" class="site-nav">Columns with Items</a></li>
                                    <li><a href="home6-modern.html" class="site-nav">Text columns with images</a></li>
                                    <li><a href="home2-default.html" class="site-nav">Products Carousel</a></li>
                                    <li><a href="home9-parallax.html" class="site-nav last">Parallax Banner</a></li>
                                </ul>
                            </li>
                            <li><a href="#" class="site-nav">New Features<i class="anm anm-plus-l"></i></a>
                                <ul>
                                    <li><a href="home13-auto-parts.html" class="site-nav">Top Information Bar </a></li>
                                    <li><a href="#" class="site-nav">Age Varification </a></li>
                                    <li><a href="#" class="site-nav">Footer Blocks</a></li>
                                    <li><a href="#" class="site-nav">2 New Megamenu style</a></li>
                                    <li><a href="#" class="site-nav">Show Total Savings </a></li>
                                    <li><a href="#" class="site-nav">New Custom Icons</a></li>
                                    <li><a href="#" class="site-nav last">Auto Currency</a></li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li class="lvl1 parent megamenu"><a href="#">Shop <i class="anm anm-plus-l"></i></a>
                        <ul>
                            <li><a href="#" class="site-nav">Shop Pages<i class="anm anm-plus-l"></i></a>
                                <ul>
                                    <li><a href="shop-left-sidebar.html" class="site-nav">Left Sidebar</a></li>
                                    <li><a href="shop-right-sidebar.html" class="site-nav">Right Sidebar</a></li>
                                    <li><a href="shop-fullwidth.html" class="site-nav">Fullwidth</a></li>
                                    <li><a href="shop-grid-3.html" class="site-nav">3 items per row</a></li>
                                    <li><a href="shop-grid-4.html" class="site-nav">4 items per row</a></li>
                                    <li><a href="shop-grid-5.html" class="site-nav">5 items per row</a></li>
                                    <li><a href="shop-grid-6.html" class="site-nav">6 items per row</a></li>
                                    <li><a href="shop-grid-7.html" class="site-nav">7 items per row</a></li>
                                    <li><a href="shop-listview.html" class="site-nav last">Product Listview</a></li>
                                </ul>
                            </li>
                            <li><a href="#" class="site-nav">Shop Features<i class="anm anm-plus-l"></i></a>
                                <ul>
                                    <li><a href="shop-left-sidebar.html" class="site-nav">Product Countdown </a></li>
                                    <li><a href="shop-right-sidebar.html" class="site-nav">Infinite Scrolling</a></li>

                                    <li><a href="shop-grid-3.html" class="site-nav">Pagination - Classic</a></li>
                                    <li><a href="shop-grid-6.html" class="site-nav">Pagination - Load More</a></li>
                                    <li><a href="product-labels.html" class="site-nav">Dynamic Product Labels</a></li>
                                    <li><a href="product-swatches-style.html" class="site-nav">Product Swatches </a>
                                    </li>
                                    <li><a href="product-hover-info.html" class="site-nav">Product Hover Info</a></li>
                                    <li><a href="shop-grid-3.html" class="site-nav">Product Reviews</a></li>
                                    <li><a href="shop-left-sidebar.html" class="site-nav last">Discount Label </a></li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li class="lvl1 parent megamenu"><a href="product-layout-1.html">Product <i
                                class="anm anm-plus-l"></i></a>
                        <ul>
                            <li><a href="product-layout-1.html" class="site-nav">Product Page<i
                                        class="anm anm-plus-l"></i></a>
                                <ul>
                                    <li><a href="product-layout-1.html" class="site-nav">Product Layout 1</a></li>
                                    <li><a href="product-layout-2.html" class="site-nav">Product Layout 2</a></li>
                                    <li><a href="product-layout-3.html" class="site-nav">Product Layout 3</a></li>
                                    <li><a href="product-with-left-thumbs.html" class="site-nav">Product With Left
                                            Thumbs</a></li>
                                    <li><a href="product-with-right-thumbs.html" class="site-nav">Product With Right
                                            Thumbs</a></li>
                                    <li><a href="product-with-bottom-thumbs.html" class="site-nav last">Product With
                                            Bottom Thumbs</a></li>
                                </ul>
                            </li>
                            <li><a href="short-description.html" class="site-nav">Product Features<i
                                        class="anm anm-plus-l"></i></a>
                                <ul>
                                    <li><a href="short-description.html" class="site-nav">Short Description</a></li>
                                    <li><a href="product-countdown.html" class="site-nav">Product Countdown</a></li>
                                    <li><a href="product-video.html" class="site-nav">Product Video</a></li>
                                    <li><a href="product-quantity-message.html" class="site-nav">Product Quantity
                                            Message</a></li>
                                    <li><a href="product-visitor-sold-count.html" class="site-nav">Product Visitor/Sold
                                            Count </a></li>
                                    <li><a href="product-zoom-lightbox.html" class="site-nav last">Product Zoom/Lightbox
                                        </a></li>
                                </ul>
                            </li>
                            <li><a href="#" class="site-nav">Product Features<i class="anm anm-plus-l"></i></a>
                                <ul>
                                    <li><a href="product-with-variant-image.html" class="site-nav">Product with Variant
                                            Image</a></li>
                                    <li><a href="product-with-color-swatch.html" class="site-nav">Product with Color
                                            Swatch</a></li>
                                    <li><a href="product-with-image-swatch.html" class="site-nav">Product with Image
                                            Swatch</a></li>
                                    <li><a href="product-with-dropdown.html" class="site-nav">Product with Dropdown</a>
                                    </li>
                                    <li><a href="product-with-rounded-square.html" class="site-nav">Product with Rounded
                                            Square</a></li>
                                    <li><a href="swatches-style.html" class="site-nav last">Product Swatches All
                                            Style</a></li>
                                </ul>
                            </li>
                            <li><a href="#" class="site-nav">Product Features<i class="anm anm-plus-l"></i></a>
                                <ul>
                                    <li><a href="product-accordion.html" class="site-nav">Product Accordion</a></li>
                                    <li><a href="product-pre-orders.html" class="site-nav">Product Pre-orders </a></li>
                                    <li><a href="product-labels-detail.html" class="site-nav">Product Labels</a></li>
                                    <li><a href="product-discount.html" class="site-nav">Product Discount In %</a></li>
                                    <li><a href="product-shipping-message.html" class="site-nav">Product Shipping
                                            Message</a></li>
                                    <li><a href="product-shipping-message.html" class="site-nav last">Size Guide </a>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li class="lvl1 parent megamenu"><a href="about-us.html">Pages <i class="anm anm-plus-l"></i></a>
                        <ul>
                            <li><a href="cart-variant1.html" class="site-nav">Cart Page <i
                                        class="anm anm-plus-l"></i></a>
                                <ul class="dropdown">
                                    <li><a href="cart-variant1.html" class="site-nav">Cart Variant1</a></li>
                                    <li><a href="cart-variant2.html" class="site-nav">Cart Variant2</a></li>
                                </ul>
                            </li>
                            <li><a href="compare-variant1.html" class="site-nav">Compare Product <i
                                        class="anm anm-plus-l"></i></a>
                                <ul class="dropdown">
                                    <li><a href="compare-variant1.html" class="site-nav">Compare Variant1</a></li>
                                    <li><a href="compare-variant2.html" class="site-nav">Compare Variant2</a></li>
                                </ul>
                            </li>
                            <li><a href="checkout.html" class="site-nav">Checkout</a></li>
                            <li><a href="about-us.html" class="site-nav">About Us<span
                                        class="lbl nm_label1">New</span></a></li>
                            <li><a href="contact-us.html" class="site-nav">Contact Us</a></li>
                            <li><a href="faqs.html" class="site-nav">FAQs</a></li>
                            <li><a href="lookbook1.html" class="site-nav">Lookbook<i class="anm anm-plus-l"></i></a>
                                <ul>
                                    <li><a href="lookbook1.html" class="site-nav">Style 1</a></li>
                                    <li><a href="lookbook2.html" class="site-nav last">Style 2</a></li>
                                </ul>
                            </li>
                            <li><a href="404.html" class="site-nav">404</a></li>
                            <li><a href="coming-soon.html" class="site-nav">Coming soon<span
                                        class="lbl nm_label1">New</span></a></li>
                        </ul>
                    </li>
                    <li class="lvl1 parent megamenu"><a href="blog-left-sidebar.html">Blog <i
                                class="anm anm-plus-l"></i></a>
                        <ul>
                            <li><a href="blog-left-sidebar.html" class="site-nav">Left Sidebar</a></li>
                            <li><a href="blog-right-sidebar.html" class="site-nav">Right Sidebar</a></li>
                            <li><a href="blog-fullwidth.html" class="site-nav">Fullwidth</a></li>
                            <li><a href="blog-grid-view.html" class="site-nav">Gridview</a></li>
                            <li><a href="blog-article.html" class="site-nav">Article</a></li>
                        </ul>
                    </li>
                    <li class="lvl1"><a href="#"><b>Buy Now!</b></a>
                    </li>
                </ul>
            </div>
            <!--End Mobile Menu-->

            <!--Body Content-->
            <div id="page-content">
                <!--Page Title-->
                <div class="page section-header text-center">
                    <div class="page-title">
                        <div class="wrapper">
                            <h1 class="page-width">Checkout</h1>
                        </div>
                    </div>
                </div>
                <!--End Page Title-->

                <div class="container">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="customer-box returning-customer p-3 border rounded">
                                <h5 class="mb-3">
                                    <i class="icon anm anm-user-al"></i> Returning customer?
                                    <a href="#customer-login" id="customer" class="text-decoration-underline"
                                        data-toggle="collapse">
                                        Click here to Add address
                                    </a>
                                </h5>
                                <div id="customer-login" class="collapse customer-content">
                                    <div class="customer-info">
                                        <p class="small text-muted mb-3">
                                            If you have shopped with us before, please enter your details below. New
                                            customers can proceed to the Billing & Shipping section.
                                        </p>
                                        <form action="/checkoutAddressAdd" method="post">
                                            <div class="mb-2">
                                                <label class="form-label small">Full Name</label>
                                                <input type="text" name="Fullname" class="form-control form-control-sm">
                                            </div>
                                            <div class="mb-2">
                                                <label class="form-label small">Address</label>
                                                <input type="text" name="Address" class="form-control form-control-sm">
                                            </div>
                                            <div class="mb-2">
                                                <label class="form-label small">City</label>
                                                <input type="text" name="city" class="form-control form-control-sm">
                                            </div>
                                            <div class="mb-2">
                                                <label class="form-label small">State</label>
                                                <input type="text" name="State" class="form-control form-control-sm">
                                            </div>
                                            <div class="mb-2">
                                                <label class="form-label small">Pin Code</label>
                                                <input type="text" name="pinCode" class="form-control form-control-sm">
                                            </div>
                                            <div class="mb-2">
                                                <label class="form-label small">Country</label>
                                                <input type="text" name="Country" class="form-control form-control-sm">
                                            </div>
                                            <div class="mb-2">
                                                <label class="form-label small">Phone</label>
                                                <input type="text" name="phone" class="form-control form-control-sm">
                                            </div>
                                            <div class="mb-2">
                                                <span class="form-label small">Address Type</span>
                                                <div>
                                                    <div class="form-check form-check-inline">
                                                        <input type="radio" name="addressType" value="Home"
                                                            class="form-check-input">
                                                        <label class="form-check-label small">Home</label>
                                                    </div>
                                                    <div class="form-check form-check-inline">
                                                        <input type="radio" name="addressType" value="Work"
                                                            class="form-check-input" checked>
                                                        <label class="form-check-label small">Work</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <button type="submit" class="btn btn-primary btn-sm w-100">Submit</button>
                                        </form>
                                    </div>
                                </div>
                            </div>


                        </div>



                    </div>
                    <button id="openCouponModal"
                        style="background-color: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 16px;">
                        Available Coupons
                    </button>
                    <br><br>

                    <!-- Coupon Modal -->
                    <div id="couponModal"
                        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1000;">
                        <div
                            style="background-color: white; width: 80%; max-width: 500px; margin: 10% auto; border-radius: 10px; padding: 20px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);">
                            <span class="close"
                                style="font-size: 20px; font-weight: bold; color: #333; float: right; cursor: pointer;">&times;</span>
                            <h2 style="color: #007bff; text-align: center; margin-bottom: 20px;">Available Coupons</h2>
                            <div id="couponList" style="max-height: 300px; overflow-y: auto;">
                                <% if (coupons && coupons.length> 0) { %>
                                    <ul style="list-style: none; padding: 0;">
                                        <% coupons.forEach(coupon=> { %>
                                            <li
                                                style="border: 1px solid #ddd; padding: 10px; margin-bottom: 10px; border-radius: 5px;">
                                                <strong style="color: #333;">Code:</strong>
                                                <%= coupon.code %> <br>
                                                    <strong style="color: #333;">Type:</strong>
                                                    <%= coupon.discountType %> <br>
                                                        <strong style="color: #333;">Value:</strong>
                                                        <% if (coupon.discountType==='percentage' ) { %>
                                                            <%= coupon.discountValue %>% Off
                                                                <% } else { %>
                                                                    ₹<%= coupon.discountValue %> Off
                                                                        <% } %> <br>
                                                                            <strong style="color: #333;">Minimum
                                                                                Purchase:</strong> ₹<%=
                                                                                coupon.minimumPurchase %> <br>
                                                                                <strong style="color: #333;">Maximum
                                                                                    Discount:</strong> ₹<%=
                                                                                    coupon.maximumAmountdiscount %> <br>
                                                                                    <strong style="color: #333;">Expires
                                                                                        On:</strong>
                                                                                    <%= new
                                                                                        Date(coupon.expirationDate).toLocaleDateString()
                                                                                        %> <br>
                                                                                        <button  class="apply-coupon-btn"
                                                                                            data-code="<%= coupon.code %>"
                                                                                            data-type="<%= coupon.discountType %>"
                                                                                            data-value="<%= coupon.discountValue %>"
                                                                                            data-min-purchase="<%= coupon.minimumPurchase %>"
                                                                                            data-max-discount="<%= coupon.maximumAmountdiscount %>"
                                                                                            style="background-color: #28a745; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-size: 14px; margin-top: 10px;">
                                                                                            Appllly
                                                                                        </button>
                                            </li>
                                            <% }); %>
                                    </ul>
                                    <% } else { %>
                                        <p style="text-align: center; color: #999;">No available coupons at the moment.
                                        </p>
                                        <% } %>
                            </div>
                        </div>
                    </div>


                    <form onclick=" coupenFunction('<%= userid%>')"  action="/orderComplete?id=<%= userid  %>" method="post">  
                        <div class="row billing-fields">
                            <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 sm-margin-30px-bottom">
                                <div class="create-ac-content bg-light-gray padding-20px-all">
                                    <div id="addressList" style="margin-top: 2em;">
                                        <% for (let i=0; i < data.address.length; i++) { %>
                                            <% if (data.address.length> 0) { %>

                                                <!-- Address Block Start -->
                                                <div
                                                    style="border-bottom: 1px solid #ccc; padding: 1em 0; display: flex; justify-content: space-between; align-items: center;">
                                                    <label style="width: 100%; display: flex; cursor: pointer;">
                                                        <!-- Radio button to select the delivery address -->
                                                        <input type="radio" name="selectedAddressId"
                                                            value="<%= data.address[i]._id %>" required
                                                            style="margin-right: 1em; align-self: start;" >

                                                        <div>
                                                            <p>
                                                                <span style="
                                                        display: inline-block;
                                                        padding: 0.25em 0.5em;
                                                        font-size: 12px;
                                                        font-weight: bold;
                                                        color: #333;
                                                        background-color: #f1f1f1;
                                                        border-radius: 4px;
                                                        text-transform: uppercase;
                                                        box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.2);
                                                    ">
                                                                    <%= data.address[i].addressType %>

                                                                </span>
                                                            </p>
                                                            <p><strong>
                                                                    <%= data.address[i].Fullname %>
                                                                </strong></p>

                                                            <p>
                                                                <%= data.address[i].Address %>
                                                            </p>

                                                            <p>
                                                                <%= data.address[i].State %>, <%=
                                                                        data.address[i].pinCode %>, <%=
                                                                            data.address[i].Country %>
                                                            </p>

                                                            <p>Phone: <%= data.address[i].phone %>
                                                            </p>

                                                        </div>
                                                    </label>
                                                    <div>
                                                        
                                                        <button 
                                                        type="button" 
                                                        data-address='<%= JSON.stringify(data.address[i]) %>' 
                                                        onclick="toggleEditForm(this)"
                                                        style="margin-right: 1em; padding: 0.5em 1em; border: none; background-color: #007bff; color: white; cursor: pointer; border-radius: 5px;"
                                                        >
                                                        Edit
                                                    </button>
                                                         
                                                    </div>
                                                </div>

                                                <!-- Hidden Edit Form -->
                                                 
                                                <input type="hidden" name="totalprice" value="<%= totalprice %>">
                                                <input type="hidden" id="discounttest" name="discountAmount" value="">
                                                <input type="hidden" id="applycoutpon" name="appliedCoupon" value="">

                                                <!-- Address Block End -->
                                                <% } else { %>
                                                    <div>
                                                        <p>Enter your updated address</p>
                                                    </div>
                                                    <% } %>
                                                        <% } %>
                                    </div>

                                </div>
                            </div>

                            <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12">
                                <div class="your-order-payment">
                                    <div class="your-order">
                                        <h2 class="order-title mb-4">Your Order</h2>

                                        <div class="table-responsive-sm order-table">
                                            <table class="bg-white table table-bordered table-hover text-center">
                                                <thead>
                                                    <tr>
                                                        <th class="text-left">produt Name</th>

                                                        <th>Price</th>
                                                        <th>Size</th>
                                                        <th>Qty</th>
                                                        <th>Subtotal</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <% for(let i=0 ; i < cartdata.length ; i++ ) { %>

                                                        <tr>
                                                            <td class="text-left">
                                                                <%=cartdata[i].name %>
                                                            </td>
                                                            <input type="hidden" name="productId"
                                                                value="<%=cartdata[i].productId %>">
                                                            <input type="hidden" name="name"
                                                                value="<%=cartdata[i].name %>">
                                                            <td>
                                                                <%=cartdata[i].price %>
                                                            </td>
                                                            <input type="hidden" name="size"
                                                                value="<%=cartdata[i].size %>">
                                                            <td>
                                                                <%=cartdata[i].size %>
                                                            </td>

                                                            <td>
                                                                <%=cartdata[i].quantity %>
                                                            </td>
                                                            <input type="hidden" name="sub_total"
                                                                value="<%= cartdata[i].price * cartdata[i].quantity %>">

                                                            <td>
                                                                <%= cartdata[i].price * cartdata[i].quantity %>
                                                            </td>
                                                            </td>
                                                        </tr>
                                                        <% } %>
                                                </tbody>
                                                <tfoot class="font-weight-600">
                                                    <tr id="discountRow" style="display: none;">
                                                        <td colspan="4" class="text-right">Discount</td>
                                                        <td id="discountAmountDisplay">- ₹0.00</td>
                                                    </tr>
                                                    <tr>
                                                        <td colspan="4" class="text-right">Shipping</td>
                                                        <td>0</td>
                                                    </tr>
                                                    <tr>
                                                        <td colspan="4" class="text-right">Total</td>
                                                        <input type="hidden" name="totalprice" value="<%= totalprice %>">
                                                        <td id="totalPriceDisplay">
                                                            ₹<%= totalprice %>
                                                        </td>
                                                    </tr>
                                                  
                                                   
                                                    <tr id="removeCouponRow" style="display: none;">
                                                        <td colspan="5" class="text-right">
                                                            <button type="button" id="removeCouponBtn" style="background-color: #dc3545; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-size: 14px;">
                                                                Remove Coupon
                                                            </button>
                                                        </td>
                                                    </tr>
                                                </tfoot>
                                                
                                            </table>
                                        </div>
                                    </div>

                                    <hr />

                                    <div class="your-payment">
                                        <h2 class="payment-title mb-3">payment options</h2>
                                        <div class="payment-method">
                                            <!DOCTYPE html>
                                            <html lang="en">

                                            <head>
                                                <meta charset="UTF-8">
                                                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                                                <title>Payment Options</title>
                                                <link rel="stylesheet"
                                                    href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
                                        
                                            </head>

                                            <body>

                                              <div class="container mt-5">
    <div class="payment-accordion">
        <div id="accordion" class="payment-section">
            <!-- Cash On Delivery Option -->
            <div class="card mb-2">
                <div class="card-header">
                    <label>
                        <input type="radio" value="COD" name="paymentmethod" required>
                        Cash On Delivery
                    </label>
                </div>
            </div>

            <!-- Wallet Option -->
            <div class="card mb-2">
                <div class="card-header">
                    <label>
                        <input type="radio" value="WALLET" name="paymentmethod" required>
                        Wallet
                    </label>
                </div>
            </div>

            <!-- Razorpay Option -->
            <div class="card mb-2">
                <div class="card-header">
                    <label>
                        <input type="radio" value="online" name="paymentmethod" required>
                        Razorpay
                    </label>
                </div>
            </div>
        </div>
    </div>
</div>



<div id="error-message" style="color: red; margin-top: 10px;"></div>


                                                <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
                                                <script
                                                    src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
                                             
                                            </body>

                                            </html>
                                            <div class="order-button-payment text-left my-4">
                                                <button class="btn btn-dark btn-lg w-50" type="submit">Place
                                                    Order</a></button>
                                            </div>
                    </form>

                </div>
            </div>
    </div>
    </div>
    </div>



    </div>
    <div id="editModal" class="modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Address</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="closeModal()">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="editAddressForm" action="/checkoutAddressEdit" method="post">
                        <div style="margin-bottom: 1em;">
                            <label for="name">Full Name:</label>
                            <input type="text" id="modalFullName" name="Fullname" class="form-control">
                        </div>
                        <input type="hidden" id="modaladdressId" name="addressId" class="form-control" >
                        <div style="margin-bottom: 1em;">
                            <label for="address">Address:</label>
                            <input type="text" id="modalAddress" name="Address" class="form-control">
                        </div>
                        <div style="margin-bottom: 1em;">
                            <label for="state">City:</label>
                            <input type="text" id="modalCity" name="city" class="form-control">
                        </div>
                        <div style="margin-bottom: 1em;">
                            <label for="zip">State:</label>
                            <input type="text" id="modalState" name="State" class="form-control">
                        </div>
                        <div style="margin-bottom: 1em;">
                            <label for="phone">Pin Code:</label>
                            <input type="text" id="modalPinCode" name="pinCode" class="form-control">
                        </div>
                        <div style="margin-bottom: 1em;">
                            <label for="phone">Country:</label>
                            <input type="text" id="modalCountry" name="Country" class="form-control">
                        </div>
                        <div style="margin-bottom: 1em;">
                            <label for="phone">Phone:</label>
                            <input type="text" id="modalPhone" name="phone" class="form-control">
                        </div>
                        <div>
                            <span style="font-size: 14px; color: #6c757d; margin-right: 10px;">Address Type</span>
                            <label style="margin-right: 10px;">
                                <input type="radio" name="addressType" value="Home" id="modalAddressTypeHome"> Home
                            </label>
                            <label style="margin-right: 10px;">
                                <input type="radio" name="addressType" value="Work" id="modalAddressTypeWork"> Work
                            </label>
                        </div>
                        <button type="submit" style="padding: 0.5em 1em; border: none; background-color: #28a745; color: white; cursor: pointer; border-radius: 5px;">
                            Save Changes
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    </div>
    <!--End Body Content-->
<!-- Edit Address Modal -->


    <!--Footer-->
    <footer id="footer">
        <div class="newsletter-section">
            <div class="container">
                <div class="row">
                    <div
                        class="col-12 col-sm-12 col-md-12 col-lg-7 w-100 d-flex justify-content-start align-items-center">
                        <div class="display-table">
                            <div class="display-table-cell footer-newsletter">
                                <div class="section-header text-center">
                                    <label class="h2"><span>sign up for </span>newsletter</label>
                                </div>
                                <form action="#" method="post">
                                    <div class="input-group">
                                        <input type="email" class="input-group__field newsletter__input" name="EMAIL"
                                            value="" placeholder="Email address" required="">
                                        <span class="input-group__btn">
                                            <button type="submit" class="btn newsletter__submit" name="commit"
                                                id="Subscribe"><span
                                                    class="newsletter__submit-text--large">Subscribe</span></button>
                                        </span>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-sm-12 col-md-12 col-lg-5 d-flex justify-content-end align-items-center">
                        <div class="footer-social">
                            <ul class="list--inline site-footer__social-icons social-icons">
                                <li><a class="social-icons__link" href="#" target="_blank"
                                        title="Belle Multipurpose Bootstrap 4 Template on Facebook"><i
                                            class="icon icon-facebook"></i></a></li>
                                <li><a class="social-icons__link" href="#" target="_blank"
                                        title="Belle Multipurpose Bootstrap 4 Template on Twitter"><i
                                            class="icon icon-twitter"></i> <span
                                            class="icon__fallback-text">Twitter</span></a></li>
                                <li><a class="social-icons__link" href="#" target="_blank"
                                        title="Belle Multipurpose Bootstrap 4 Template on Pinterest"><i
                                            class="icon icon-pinterest"></i> <span
                                            class="icon__fallback-text">Pinterest</span></a></li>
                                <li><a class="social-icons__link" href="#" target="_blank"
                                        title="Belle Multipurpose Bootstrap 4 Template on Instagram"><i
                                            class="icon icon-instagram"></i> <span
                                            class="icon__fallback-text">Instagram</span></a></li>
                                <li><a class="social-icons__link" href="#" target="_blank"
                                        title="Belle Multipurpose Bootstrap 4 Template on Tumblr"><i
                                            class="icon icon-tumblr-alt"></i> <span
                                            class="icon__fallback-text">Tumblr</span></a></li>
                                <li><a class="social-icons__link" href="#" target="_blank"
                                        title="Belle Multipurpose Bootstrap 4 Template on YouTube"><i
                                            class="icon icon-youtube"></i> <span
                                            class="icon__fallback-text">YouTube</span></a></li>
                                <li><a class="social-icons__link" href="#" target="_blank"
                                        title="Belle Multipurpose Bootstrap 4 Template on Vimeo"><i
                                            class="icon icon-vimeo-alt"></i> <span
                                            class="icon__fallback-text">Vimeo</span></a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="site-footer">
            <div class="container">
                <!--Footer Links-->
                <div class="footer-top">
                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-3 col-lg-3 footer-links">
                            <h4 class="h4">Quick Shop</h4>
                            <ul>
                                <li><a href="#">Women</a></li>
                                <li><a href="#">Men</a></li>
                                <li><a href="#">Kids</a></li>
                                <li><a href="#">Sportswear</a></li>
                                <li><a href="#">Sale</a></li>
                            </ul>
                        </div>
                        <div class="col-12 col-sm-12 col-md-3 col-lg-3 footer-links">
                            <h4 class="h4">Informations</h4>
                            <ul>
                                <li><a href="#">About us</a></li>
                                <li><a href="#">Careers</a></li>
                                <li><a href="#">Privacy policy</a></li>
                                <li><a href="#">Terms &amp; condition</a></li>
                                <li><a href="#">My Account</a></li>
                            </ul>
                        </div>
                        <div class="col-12 col-sm-12 col-md-3 col-lg-3 footer-links">
                            <h4 class="h4">Customer Services</h4>
                            <ul>
                                <li><a href="#">Request Personal Data</a></li>
                                <li><a href="#">FAQ's</a></li>
                                <li><a href="#">Contact Us</a></li>
                                <li><a href="#">Orders and Returns</a></li>
                                <li><a href="#">Support Center</a></li>
                            </ul>
                        </div>
                        <div class="col-12 col-sm-12 col-md-3 col-lg-3 contact-box">
                            <h4 class="h4">Contact Us</h4>
                            <ul class="addressFooter">
                                <li><i class="icon anm anm-map-marker-al"></i>
                                    <p>55 Gallaxy Enque,<br>2568 steet, 23568 NY</p>
                                </li>
                                <li class="phone"><i class="icon anm anm-phone-s"></i>
                                    <p>(440) 000 000 0000</p>
                                </li>
                                <li class="email"><i class="icon anm anm-envelope-l"></i>
                                    <p>sales@yousite.com</p>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <!--End Footer Links-->
                <hr>
                <div class="footer-bottom">
                    <div class="row">
                        <!--Footer Copyright-->
                        <div
                            class="col-12 col-sm-12 col-md-6 col-lg-6 order-1 order-md-0 order-lg-0 order-sm-1 copyright text-sm-center text-md-left text-lg-left">
                            <span></span> <a href="templateshub.net">Templates Hub</a></div>
                        <!--End Footer Copyright-->

                        <!--Footer Payment Icon-->

                        <div
                            class="col-12 col-sm-12 col-md-6 col-lg-6 order-0 order-md-1 order-lg-1 order-sm-0 payment-icons text-right text-md-center">
                            <ul class="payment-icons list--inline">
                                <li><i class="icon fa fa-cc-visa" aria-hidden="true"></i></li>
                                <li><i class="icon fa fa-cc-mastercard" aria-hidden="true"></i></li>
                                <li><i class="icon fa fa-cc-discover" aria-hidden="true"></i></li>
                                <li><i class="icon fa fa-cc-paypal" aria-hidden="true"></i></li>
                                <li><i class="icon fa fa-cc-amex" aria-hidden="true"></i></li>
                                <li><i class="icon fa fa-credit-card" aria-hidden="true"></i></li>
                            </ul>
                        </div>


                        <!--End Footer Payment Icon-->
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!--End Footer-->
    <!--Scoll Top-->
    <span id="site-scroll"><i class="icon anm anm-angle-up-r"></i></span>
    <!--End Scoll Top-->
    <!-- Including Jquery -->
    <script src="assets/js/vendor/jquery-3.3.1.min.js"></script>
    <script src="assets/js/vendor/jquery.cookie.js"></script>
    <script src="assets/js/vendor/modernizr-3.6.0.min.js"></script>
    <script src="assets/js/vendor/wow.min.js"></script>
    <!-- Including Javascript -->
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/plugins.js"></script>
    <script src="assets/js/popper.min.js"></script>
    <script src="assets/js/lazysizes.js"></script>
    <script src="assets/js/main.js"></script>
    </div>


    </body>
    <!-- belle/checkout.html   11 Nov 2019 12:44:33 GMT -->

    </html>
    <script>
        function toggleEditForm(button) {
            // Toggle the visibility of the edit form
            const editForm = button.parentElement.parentElement.nextElementSibling;
            editForm.style.display = editForm.style.display === "none" ? "block" : "none";
        }
    </script>


<script>
    async function coupenFunction(userID) {
        console.log('user id function is working ',userID)
    }
</script>


    <% if (message) { %>
        <script>


            




            Swal.fire({
                icon: '<%= message.icon %>',
                text: '<%= message.text %>',
                toast: true,
                position: 'top-right',
                showConfirmButton: false,
                timerProgressBar: true,
                timer: 1000
            });
        </script>
        <% } %>


          <script>
            function toggleEditForm(button) {
    // Populate modal fields with the data
    const addressData = JSON.parse(button.getAttribute('data-address'));
    console.log(addressData)
    document.getElementById('modaladdressId').value = addressData._id;

    document.getElementById('modalFullName').value = addressData.Fullname;
    document.getElementById('modalAddress').value = addressData.Address;
    document.getElementById('modalCity').value = addressData.city;
    document.getElementById('modalState').value = addressData.State;
    document.getElementById('modalPinCode').value = addressData.pinCode;
    document.getElementById('modalCountry').value = addressData.Country;
    document.getElementById('modalPhone').value = addressData.phone;
    document.getElementById('modalAddressTypeHome').checked = addressData.addressType === 'Home';
    document.getElementById('modalAddressTypeWork').checked = addressData.addressType === 'Work';
    const addressId=addressData._id
    // Open the modal
    const modal = document.getElementById('editModal');
    modal.style.display = 'block';
}

// Function to close the modal
function closeModal() {
    const modal = document.getElementById('editModal');
    modal.style.display = 'none';
}

          </script>
            <!-- Inline Script -->



         <script>
            document.addEventListener("DOMContentLoaded", () => {
    const modal = document.getElementById("couponModal");
    const openBtn = document.getElementById("openCouponModal");
    const closeBtn = modal.querySelector(".close");
    const couponButtons = document.querySelectorAll(".apply-coupon-btn");
    const totalPriceElement = document.querySelector('input[name="totalprice"]');
    const displayedTotalElement = document.getElementById('totalPriceDisplay');
    const discountRow = document.getElementById('discountRow');
    const discountAmountDisplay = document.getElementById('discountAmountDisplay');
    const removeCouponRow = document.getElementById('removeCouponRow');
    const removeCouponBtn = document.getElementById('removeCouponBtn');
    let appliedCoupon = null;

    // Open modal
    openBtn.addEventListener("click", () => {
        modal.style.display = "block";
    });

    // Close modal
    closeBtn.addEventListener("click", () => {
        modal.style.display = "none";
    });

    // Apply coupon
    couponButtons.forEach(button => {
        button.addEventListener("click", (e) => {
            try {
                const coupon = e.target.dataset;
                const originalTotal = parseFloat(totalPriceElement.value);

                if (isNaN(originalTotal)) {
                    throw new Error("Invalid total amount");
                }

                const minPurchase = parseFloat(coupon.minPurchase);
                const maxDiscount = parseFloat(coupon.maxDiscount);
                const discountValue = parseFloat(coupon.value);

                if (isNaN(minPurchase) || isNaN(maxDiscount) || isNaN(discountValue)) {
                    throw new Error("Invalid coupon values");
                }

                if (originalTotal < minPurchase) {
                    Swal.fire({
                        icon: 'error',
                        text: `Minimum purchase amount of ₹${minPurchase.toFixed(2)} not met.`,
                        toast: true,
                        position: 'top-right',
                        showConfirmButton: false,
                        timer: 3000
                    });
                    return;
                }

                let discountAmount = (coupon.type === 'percentage') ? (originalTotal * discountValue) / 100 : discountValue;
                discountAmount = Math.min(discountAmount, maxDiscount, originalTotal);

                const discountedTotal = originalTotal - discountAmount;
  
                // Update the displayed total
                displayedTotalElement.textContent = `₹${discountedTotal.toFixed(2)}`;

                // Show the discount row and remove coupon button
                discountAmountDisplay.textContent = `- ₹${discountAmount.toFixed(2)}`;

                document.getElementById('discounttest').value = [`${discountAmount.toFixed(2)}`];

                discountRow.style.display = 'table-row';
                removeCouponRow.style.display = 'table-row';

                appliedCoupon = {
                    code: coupon.code,
                    discountAmount: discountAmount
                };
                

                modal.style.display = "none";
                document.getElementById('applycoutpon').value =[ `${coupon.code}`];
                Swal.fire({
                    icon: 'success',
                    text: `Coupon ${coupon.code} applied! Discount: ₹${discountAmount.toFixed(2)}`,
                    toast: true,
                    position: 'top-right',
                    showConfirmButton: false,
                    timer: 3000
                });
            } catch (error) {
                console.error('Error applying coupon:', error);
                Swal.fire({
                    icon: 'error',
                    text: 'Error applying coupon. Please try again.',
                    toast: true,
                    position: 'top-right',
                    showConfirmButton: false,
                    timer: 3000
                });
            }
        });
    });

    // Remove coupon
    removeCouponBtn.addEventListener("click", () => {
        const originalTotal = parseFloat(totalPriceElement.value);

        // Reset displayed total
        displayedTotalElement.textContent = `₹${originalTotal.toFixed(2)}`;
        document.getElementById('discounttest').value = [0];
        document.getElementById('applycoutpon').value = [''];

        // Hide discount and remove coupon button
        discountRow.style.display = 'none';
        removeCouponRow.style.display = 'none';

        appliedCoupon = null;

        Swal.fire({
            icon: 'info',
            text: 'Coupon removed successfully.',
            toast: true,
            position: 'top-right',
            showConfirmButton: false,
            timer: 3000
        });
    });

    // Close modal when clicking outside
    window.addEventListener("click", (e) => {
        if (e.target === modal) {
            modal.style.display = "none";
        }
    });

    // Update form submission
    document.querySelector('form').addEventListener('submit', (e) => {
    if (appliedCoupon) {
        const discountedTotal = parseFloat(displayedTotalElement.textContent.replace('₹', ''));
        if (!isNaN(discountedTotal)) {
            document.querySelector('input[name="totalprice"]').value = discountedTotal.toFixed(2);

            // Update or create discountAmount input
            let discountInput = document.querySelector('input[name="discountAmount"]');
            if (!discountInput) {
                discountInput = document.createElement('input');
                discountInput.type = 'hidden';
                discountInput.name = 'discountAmount';
                e.target.appendChild(discountInput);
            }
            discountInput.value = appliedCoupon.discountAmount.toFixed(2);

            // Update or create appliedCoupon input
            let couponInput = document.querySelector('input[name="appliedCoupon"]');
            if (!couponInput) {
                couponInput = document.createElement('input');
                couponInput.type = 'hidden';
                couponInput.name = 'appliedCoupon';
                e.target.appendChild(couponInput);
            }
            couponInput.value = appliedCoupon.code;
        }
    } else {
        // Reset discount and coupon inputs if no coupon is applied
        document.querySelector('input[name="discountAmount"]')?.remove();
        document.querySelector('input[name="appliedCoupon"]')?.remove();
    }
});

});

         </script>


<script>
    document.querySelectorAll('input[name="payment-method"]').forEach((radio) => {
        radio.addEventListener('change', function () {
            const target = this.getAttribute('href');
            document.querySelector(target).classList.add('show');
            document.querySelectorAll('.collapse').forEach(collapse => {
                if (collapse.id !== target.substring(1)) {
                    collapse.classList.remove('show');
                }
            });
        });
    });
</script>